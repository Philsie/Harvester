<html>

<head>
  <title>Video Streaming Demonstration</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/index.css') }}">
  <script>
    function keepRatioWidth() {
      if (document.getElementById("aspectRatio").checked) {
        document.getElementById("height").value = Math.round(parseFloat((document.getElementById("width").value * {{ res[1]}}) /{{res[0]}}))
    } ;
  }
  </script>
  <script>
  function keepRatioHeight() {
      if (document.getElementById("aspectRatio").checked) {
        document.getElementById("width").value = Math.round(parseFloat((document.getElementById("height").value * {{ res[0]}}) /{{res[1]}}))
    } ;
  }
  </script>
  <script src="//code.jquery.com/jquery-1.11.1.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
  <script type="text/javascript">
      var socket = io.connect();
      socket.on('connect', function() {
          console.log('Connected to server');
          socket.emit("settings","data")
      });
      socket.on('temp_feed', function(data) {
          console.log('Received data from temp_feed: ', data);
          // Update the website with the received data
          document.getElementById('temp_feed').innerHTML = "current temperature: "+data;
      });
      socket.on('video_feed', function(data) {
          console.log('Received data from video_feed: ', data);
          // Update the website with the received data
          document.getElementById('cam').src = 'data:image/jpeg;base64,' + data.image;;
      });
      socket.on('time', function(data) {
          console.log('Received data from time: ', data);
          // Update the website with the received data
          document.getElementById('time').innerHTML = "current time: "+data;;
      });
      socket.on('fps', function(data) {
          console.log('Received data from fps: ', data);
          // Update the website with the received data
          document.getElementById('fps').innerHTML = "current fps: " +data;;
      });
  </script>
</head>

<body>
  <script>var socket = io.connect();socket.emit("settings","formDataDict");</script>
  <h1>Video Streaming Demonstration</h1>
  <form action="/cam_config" method="POST" id="form">
    <div class="container">
      <!--Exposure-->
      <div>
        <p><input type="number" name="exposure" value="{{expo}}" id="exposure"/></p>
        <label for="exposure"> Exposure </label>
      </div>
      <!--Gain-->
      <div>
        <p><input type="number" name="gain" value="{{gain}}" id="gain"/> </p>
        <label for="gain"> Gain </label>
      </div>
      <!--AspectRatio-->
      <div>
        <p>
          <input type="checkbox" id="aspectRatio" checked>
          <label for="aspectRatio">keep aspect ratio</label>
        </p>
      </div>
      <!--Width-->
      <div>
        <p><input type="number" name="width" value="{{res[0]}}" id="width" onchange="keepRatioWidth()" /></p>
        <label for="width"> Width </label>
      </div>
      <!--Height-->
      <div>
        <p><input type="number" name="height" value="{{res[1]}}" id="height" onchange="keepRatioHeight()"/></p>
        <label for="height"> Height </label>
      </div>
      <!--PixelFormat-->
      <div>
        <p>
          <select name="PixelFormat" class="selectpicker form-control" id="pixelformat">
            {% for pf in available_pixelformats %}
              {% if pf == pixelformat%}
                <option value="{{ pf }}" selected="selected" >{{ pf }}</option>
              {% else %}
              <option value="{{ pf }}" >{{ pf }}</option>
              {%endif%}
            {% endfor %}                                              
          </select><br>
        </p>
        <label for="pixelformat"> PixelFormat </label>
      </div>
      <!--WhiteBalance-->
      <div>
        <p>
          <select name="WhiteBalance" class="selectpicker form-control" id="whitebalance">
          
              {% for wb in available_whitebalances %}
                {% if wb == whitebalance%}
                  <option value="{{ wb }}" selected="selected" >{{ wb }}</option>
                {% else %}
                <option value="{{ wb }}" >{{ wb }}</option>
                {%endif%}
              {% endfor %}                                          
          </select><br>
        </p>
        <label for="whitebalance"> WhiteBalance </label>
      </div>
      <!--CameraSelect-->

      <div>
        <p>
          <select name="CameraSelect" class="selectpicker form-control" id="cameraselect">
            {% for cam in available_Cameras %}
              {% if cam == camera%}
                <option value="{{ cam }}" selected="selected" >{{ cam }}</option>
              {% else %}
              <option value="{{ cam }}" >{{ cam }}</option>
              {%endif%}
            {% endfor %}                                              
          </select><br>
        </p>
        <label for="cameraselect"> Camera Selector </label>
      </div>

      <!--Submit-->
      <div><p><input type="submit" value="Submit" /></p></div>
      
    </div>
    
  </form>
  <div class="container">
    <div><p id="temp_feed"></p></div>
    
    <div><p id="time"></p></div>
    <div><p id="fps"></p></div>
  </div>
  <img id="cam" src="" alt="Camera Stream"><br>
  <div id="footer">
    <p><a href="{{ url_for('index') }}"><button>REFRESH</button></a></p>
    <p><a href="{{ url_for('download') }}"><button>Download Image</button></a></p>
  </div>
  <div id="footer">
    {{info|safe}}
  </div>

</body>
</html
