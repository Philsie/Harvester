<html>

<head>
  <title>Video Streaming Demonstration</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='stylesheets/index.css') }}">
  <script>
    function keepRatioWidth() {
      if (document.getElementById("aspectRatio").checked) {
        document.getElementById("height").value = Math.round(parseFloat((document.getElementById("width").value * {{ res[1]}}) /{{res[0]}}))
    } ;
  }
  </script>
  <script>
  function keepRatioHeight() {
      if (document.getElementById("aspectRatio").checked) {
        document.getElementById("width").value = Math.round(parseFloat((document.getElementById("height").value * {{ res[0]}}) /{{res[1]}}))
    } ;
  }
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.js"></script>
  <script type="text/javascript">
      var socket = io.connect();
      socket.on('connect', function() {
          console.log('Connected to server');
      });
      socket.on('temp_feed', function(data) {
          console.log('Received data from temp_feed: ', data);
          // Update the website with the received data
          document.getElementById('temp_feed').innerHTML = "current temperature: "+data;
      });
      socket.on('video_feed', function(data) {
          console.log('Received data from video_feed: ', data);
          // Update the website with the received data
          document.getElementById('cam').src = 'data:image/jpeg;base64,' + data.image;;
      });
      socket.on('time', function(data) {
          console.log('Received data from time: ', data);
          // Update the website with the received data
          document.getElementById('time').innerHTML = "current time: "+data;;
      });
      socket.on('fps', function(data) {
          console.log('Received data from fps: ', data);
          // Update the website with the received data
          document.getElementById('fps').innerHTML = "current fps: " +data;;
      });
  </script>

</head>

<body>
  <h1>Video Streaming Demonstration</h1>
  <form action="/cam_config" method="POST">
    <div class="container">
      <div>
        <p><input type="number" name="exposure" value="{{expo}}" id="exposure"/></p>
        <label for="exposure"> Exposure </label>
      </div>
      <div>
        <p><input type="number" name="gain" value="{{gain}}" id="gain"/> </p>
        <label for="gain"> Gain </label>
      </div>
      <div>
        <p>
          <input type="checkbox" id="aspectRatio" checked>
          <label for="aspectRatio">keep aspect ratio</label>
        </p>
      </div>
      <div>
        <p><input type="number" name="width" value="{{res[0]}}" id="width" onchange="keepRatioWidth()" /></p>
        <label for="width"> Width </label>
      </div>
      <div>
        <p><input type="number" name="height" value="{{res[1]}}" id="height" onchange="keepRatioHeight()"/></p>
        <label for="height"> Height </label>
      </div>
      <div>
        <p>
          <select name="PixelFormat" class="selectpicker form-control" id="pixelformat">
            {% for pf in available_pixelformats %}
              {% if pf == pixelformat%}
                <option value="{{ pf }}" selected="selected" >{{ pf }}</option>
              {% else %}
              <option value="{{ pf }}" >{{ pf }}</option>
              {%endif%}
            {% endfor %}                                              
          </select><br>
        </p>
        <label for="pixelformat"> PixelFormat </label>
      </div>
      <div><p><input type="submit" value="Submit" /></p></div>
      
    </div>
    
  </form>
  <pre id="temp_feed"></pre><br>
  <pre id="time"></pre><br>
  <pre id="fps"></pre><br>
  <img id="cam" src="" alt="Camera Stream"><br>
  <div id="footer">
    <p><a href="{{ url_for('index') }}"><button>REFRESH</button></a></p>
    <p><a href="{{ url_for('download') }}"><button>Download Image</button></a></p>
  </div>
  <div id="footer"><p>{{info|safe}} </p></div>

</body>
</html
